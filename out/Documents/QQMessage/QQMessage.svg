<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1805px" preserveAspectRatio="none" style="width:1844px;height:1805px;background:#FFFFFF;" version="1.1" viewBox="0 0 1844 1805" width="1844px" zoomAndPan="magnify"><defs><filter height="300%" id="f10k4mg3cmfcn9" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><!--MD5=[441483b6b0a951ab468a7e161ea2efc5]
cluster DataManager--><polygon fill="#FFFFFF" filter="url(#f10k4mg3cmfcn9)" points="1341,559,1440,559,1447,584.1201,1600,584.1201,1600,661,1341,661,1341,559" style="stroke:#000000;stroke-width:1.5;"/><line style="stroke:#000000;stroke-width:1.5;" x1="1341" x2="1447" y1="584.1201" y2="584.1201"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="93" x="1345" y="577.0439">DataManager</text><!--MD5=[50410012277a53ec9046333ebc973b07]
class DataManager--><rect codeLine="3" fill="#FEFECE" filter="url(#f10k4mg3cmfcn9)" height="48" id="DataManager" style="stroke:#A80036;stroke-width:1.5;" width="106" x="1478" y="597"/><ellipse cx="1493" cy="613" fill="#ADD1B2" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"/><path d="M1491.5781,618.3594 Q1489.7188,618.3594 1488.625,616.9688 Q1487.5313,615.5781 1487.5313,612.5938 Q1487.5313,610.0625 1488.6953,608.4063 Q1489.8594,606.75 1491.8438,606.75 Q1493.3125,606.75 1493.7813,606.875 Q1494.25,607.0781 1494.25,607.0781 Q1494.25,607.0781 1494.25,607.0078 Q1494.25,606.9375 1494.8594,606.0156 L1495.9063,609.6719 L1494.5781,610.0781 Q1494.1094,608.5313 1493.4453,607.8672 Q1492.7813,607.2031 1491.7188,607.2031 Q1491.3281,607.2031 1490.5625,608.7344 Q1489.7969,610.2656 1489.7969,612.5156 Q1489.7969,614.9844 1490.4609,616.375 Q1491.125,617.7656 1491.6563,617.7656 Q1492.7188,617.7656 1493.4766,617 Q1494.2344,616.2344 1494.5781,614.5781 L1495.9063,615.1719 Q1495.5781,616.5781 1494.6797,617.4688 Q1493.7813,618.3594 1491.5781,618.3594 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="74" x="1507" y="618.5576">DataManager</text><line style="stroke:#A80036;stroke-width:1.5;" x1="1479" x2="1583" y1="629" y2="629"/><line style="stroke:#A80036;stroke-width:1.5;" x1="1479" x2="1583" y1="637" y2="637"/><path d="M1357,607 L1357,634.7544 A0,0 0 0 0 1357,634.7544 L1443,634.7544 A0,0 0 0 0 1443,634.7544 L1443,625 L1477.86,621 L1443,617 L1443,617 L1433,607 L1357,607 A0,0 0 0 0 1357,607 " fill="#FBFB77" filter="url(#f10k4mg3cmfcn9)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M1433,607 L1433,617 L1443,617 L1433,607 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="65" x="1363" y="626.8979">数据库操作</text><!--MD5=[487a4e51b79de51afebc6810cd6437e6]
class QQMessage--><rect codeLine="7" fill="#FEFECE" filter="url(#f10k4mg3cmfcn9)" height="228.2754" id="QQMessage" style="stroke:#A80036;stroke-width:1.5;" width="286" x="1013" y="507"/><ellipse cx="1117.25" cy="523" fill="#ADD1B2" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"/><path d="M1115.8281,528.3594 Q1113.9688,528.3594 1112.875,526.9688 Q1111.7813,525.5781 1111.7813,522.5938 Q1111.7813,520.0625 1112.9453,518.4063 Q1114.1094,516.75 1116.0938,516.75 Q1117.5625,516.75 1118.0313,516.875 Q1118.5,517.0781 1118.5,517.0781 Q1118.5,517.0781 1118.5,517.0078 Q1118.5,516.9375 1119.1094,516.0156 L1120.1563,519.6719 L1118.8281,520.0781 Q1118.3594,518.5313 1117.6953,517.8672 Q1117.0313,517.2031 1115.9688,517.2031 Q1115.5781,517.2031 1114.8125,518.7344 Q1114.0469,520.2656 1114.0469,522.5156 Q1114.0469,524.9844 1114.7109,526.375 Q1115.375,527.7656 1115.9063,527.7656 Q1116.9688,527.7656 1117.7266,527 Q1118.4844,526.2344 1118.8281,524.5781 L1120.1563,525.1719 Q1119.8281,526.5781 1118.9297,527.4688 Q1118.0313,528.3594 1115.8281,528.3594 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="69" x="1137.75" y="528.5576">QQMessage</text><line style="stroke:#A80036;stroke-width:1.5;" x1="1014" x2="1298" y1="539" y2="539"/><ellipse cx="1024" cy="550" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;fill:none;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="103" x="1033" y="555.606">std::string connectUrl</text><ellipse cx="1024" cy="565.0229" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;fill:none;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="188" x="1033" y="570.6289">std::map&lt;long long, PeerStatus&gt; status</text><ellipse cx="1024" cy="580.0459" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;fill:none;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="189" x="1033" y="585.6519">std::map&lt;long long, RegInfo&gt; regStatus</text><ellipse cx="1024" cy="595.0688" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;fill:none;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="188" x="1033" y="600.6748">std::map&lt;long long, StuInfo&gt; getStuInfo</text><ellipse cx="1024" cy="610.0918" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;fill:none;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="260" x="1033" y="615.6978">std::map&lt;long long, HomeworkInfo&gt; getHomeworkInfo</text><ellipse cx="1024" cy="625.1147" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;fill:none;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="200" x="1033" y="630.7207">std::map&lt;long long, long long&gt;getSubmitId</text><ellipse cx="1024" cy="640.1377" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;fill:none;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="125" x="1033" y="645.7437">WebsocketClient wsClient</text><ellipse cx="1024" cy="655.1606" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;fill:none;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="139" x="1033" y="660.7666">WebsocketServer wsServer</text><line style="stroke:#A80036;stroke-width:1.5;" x1="1014" x2="1298" y1="667.1836" y2="667.1836"/><ellipse cx="1024" cy="678.1836" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" text-decoration="underline" textLength="231" x="1033" y="683.7896">void _InitClient(std::string url = "127.0.0.1:6700")</text><ellipse cx="1024" cy="693.2065" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" text-decoration="underline" textLength="116" x="1033" y="698.8125">void _InitServer(int port)</text><ellipse cx="1024" cy="708.2295" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" text-decoration="underline" textLength="59" x="1033" y="713.8354">void _Stop()</text><ellipse cx="1024" cy="723.2524" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" text-decoration="underline" textLength="229" x="1033" y="728.8584">void readMessage(const std::string&amp; message)</text><path d="M772,598 L772,643.5088 A0,0 0 0 0 772,643.5088 L978,643.5088 A0,0 0 0 0 978,643.5088 L978,625 L1012.91,621 L978,617 L978,608 L968,598 L772,598 A0,0 0 0 0 772,598 " fill="#FBFB77" filter="url(#f10k4mg3cmfcn9)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M968,598 L968,608 L978,608 L968,598 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="104" x="778" y="617.8979">初始化调度其他类</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="185" x="778" y="635.6523">启动WebSocket服务端和客户端</text><!--MD5=[1059af2d425ed384aca7939e63df4c40]
class WebsocketClient--><rect codeLine="24" fill="#FEFECE" filter="url(#f10k4mg3cmfcn9)" height="378.5049" id="WebsocketClient" style="stroke:#A80036;stroke-width:1.5;" width="383" x="964.5" y="7"/><ellipse cx="1105.25" cy="23" fill="#ADD1B2" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"/><path d="M1103.8281,28.3594 Q1101.9688,28.3594 1100.875,26.9688 Q1099.7813,25.5781 1099.7813,22.5938 Q1099.7813,20.0625 1100.9453,18.4063 Q1102.1094,16.75 1104.0938,16.75 Q1105.5625,16.75 1106.0313,16.875 Q1106.5,17.0781 1106.5,17.0781 Q1106.5,17.0781 1106.5,17.0078 Q1106.5,16.9375 1107.1094,16.0156 L1108.1563,19.6719 L1106.8281,20.0781 Q1106.3594,18.5313 1105.6953,17.8672 Q1105.0313,17.2031 1103.9688,17.2031 Q1103.5781,17.2031 1102.8125,18.7344 Q1102.0469,20.2656 1102.0469,22.5156 Q1102.0469,24.9844 1102.7109,26.375 Q1103.375,27.7656 1103.9063,27.7656 Q1104.9688,27.7656 1105.7266,27 Q1106.4844,26.2344 1106.8281,24.5781 L1108.1563,25.1719 Q1107.8281,26.5781 1106.9297,27.4688 Q1106.0313,28.3594 1103.8281,28.3594 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="93" x="1125.75" y="28.5576">WebsocketClient</text><line style="stroke:#A80036;stroke-width:1.5;" x1="965.5" x2="1346.5" y1="39" y2="39"/><rect fill="none" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="972.5" y="47"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="250" x="984.5" y="55.606">connection_metadata::ptr m_ConnectionMetadataPtr</text><rect fill="none" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="972.5" y="62.0229"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="122" x="984.5" y="70.6289">client m_WebsocketClient</text><rect fill="none" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="972.5" y="77.0459"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="326" x="984.5" y="85.6519">websocketpp::lib::shared_ptr&lt;websocketpp::lib::thread&gt; m_Thread;</text><rect fill="none" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="972.5" y="92.0688"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="88" x="984.5" y="100.6748">std::string lastURL</text><line style="stroke:#A80036;stroke-width:1.5;" x1="965.5" x2="1346.5" y1="107.0918" y2="107.0918"/><rect fill="#F24D5C" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="972.5" y="115.0918"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="145" x="984.5" y="123.6978">OnOpenFunc m_OnOpenFunc</text><rect fill="#F24D5C" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="972.5" y="130.1147"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="125" x="984.5" y="138.7207">OnFailFunc m_OnFailFunc</text><rect fill="#F24D5C" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="972.5" y="145.1377"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="147" x="984.5" y="153.7437">OnCloseFunc m_OnCloseFunc</text><rect fill="#F24D5C" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="972.5" y="160.1606"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="167" x="984.5" y="168.7666">OnMessageFunc m_MessageFunc</text><ellipse cx="975.5" cy="178.1836" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="88" x="984.5" y="183.7896">WebsocketClient()</text><ellipse cx="975.5" cy="193.2065" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" font-style="italic" lengthAdjust="spacing" textLength="100" x="984.5" y="198.8125">~WebsocketClient()</text><ellipse cx="975.5" cy="208.2295" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="171" x="984.5" y="213.8354">bool Connect(std::string const&amp; url)</text><ellipse cx="975.5" cy="223.2524" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="163" x="984.5" y="228.8584">bool Close(std::string reason = "")</text><ellipse cx="975.5" cy="238.2754" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="151" x="984.5" y="243.8813">bool Send(std::string message)</text><ellipse cx="975.5" cy="253.2983" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="261" x="984.5" y="258.9043">connection_metadata::ptr GetConnectionMetadataPtr()</text><ellipse cx="975.5" cy="268.3213" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="277" x="984.5" y="273.9272">void OnOpen(client* c, websocketpp::connection_hdl hdl)</text><ellipse cx="975.5" cy="283.3442" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="267" x="984.5" y="288.9502">void OnFail(client* c, websocketpp::connection_hdl hdl)</text><ellipse cx="975.5" cy="298.3672" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="278" x="984.5" y="303.9731">void OnClose(client* c, websocketpp::connection_hdl hdl)</text><ellipse cx="975.5" cy="313.3901" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="357" x="984.5" y="318.9961">void OnMessage(websocketpp::connection_hdl, client::message_ptr msg)</text><ellipse cx="975.5" cy="328.4131" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="200" x="984.5" y="334.019">void SetOnOpenFunc(OnOpenFunc func)</text><ellipse cx="975.5" cy="343.436" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="180" x="984.5" y="349.042">void SetOnFailFunc(OnFailFunc func)</text><ellipse cx="975.5" cy="358.459" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="202" x="984.5" y="364.0649">void SetOnCloseFunc(OnCloseFunc func)</text><ellipse cx="975.5" cy="373.4819" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="222" x="984.5" y="379.0879">void SetMessageFunc(OnMessageFunc func)</text><path d="M737,173.5 L737,219.0088 A0,0 0 0 0 737,219.0088 L929,219.0088 A0,0 0 0 0 929,219.0088 L929,200.5 L964.2,196.5 L929,192.5 L929,183.5 L919,173.5 L737,173.5 A0,0 0 0 0 737,173.5 " fill="#FBFB77" filter="url(#f10k4mg3cmfcn9)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M919,173.5 L919,183.5 L929,183.5 L919,173.5 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="107" x="743" y="193.3979">WebSocket服务端</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="171" x="743" y="211.1523">用于接收go-cqhttp发送的消息</text><!--MD5=[68b2d8e65c22da78bfb6e6180d5765c5]
class WebsocketServer--><rect codeLine="51" fill="#FEFECE" filter="url(#f10k4mg3cmfcn9)" height="183.2065" id="WebsocketServer" style="stroke:#A80036;stroke-width:1.5;" width="584" x="169" y="907"/><ellipse cx="408.75" cy="923" fill="#ADD1B2" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"/><path d="M407.3281,928.3594 Q405.4688,928.3594 404.375,926.9688 Q403.2813,925.5781 403.2813,922.5938 Q403.2813,920.0625 404.4453,918.4063 Q405.6094,916.75 407.5938,916.75 Q409.0625,916.75 409.5313,916.875 Q410,917.0781 410,917.0781 Q410,917.0781 410,917.0078 Q410,916.9375 410.6094,916.0156 L411.6563,919.6719 L410.3281,920.0781 Q409.8594,918.5313 409.1953,917.8672 Q408.5313,917.2031 407.4688,917.2031 Q407.0781,917.2031 406.3125,918.7344 Q405.5469,920.2656 405.5469,922.5156 Q405.5469,924.9844 406.2109,926.375 Q406.875,927.7656 407.4063,927.7656 Q408.4688,927.7656 409.2266,927 Q409.9844,926.2344 410.3281,924.5781 L411.6563,925.1719 Q411.3281,926.5781 410.4297,927.4688 Q409.5313,928.3594 407.3281,928.3594 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="96" x="429.25" y="928.5576">WebsocketServer</text><line style="stroke:#A80036;stroke-width:1.5;" x1="170" x2="752" y1="939" y2="939"/><rect fill="none" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="177" y="947"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="100" x="189" y="955.606">server echo_server;</text><rect fill="none" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="177" y="962.0229"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="129" x="189" y="970.6289">con_list m_connection_list;</text><rect fill="none" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="177" y="977.0459"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="323" x="189" y="985.6519">websocketpp::lib::shared_ptr&lt;websocketpp::lib::thread&gt; m_thread;</text><line style="stroke:#A80036;stroke-width:1.5;" x1="170" x2="752" y1="992.0688" y2="992.0688"/><ellipse cx="180" cy="1003.0688" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="98" x="189" y="1008.6748">WebsocketServer();</text><ellipse cx="180" cy="1018.0918" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="104" x="189" y="1023.6978">~WebsocketServer();</text><ellipse cx="180" cy="1033.1147" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" text-decoration="underline" textLength="448" x="189" y="1038.7207">void OnOpen(server* s, WebsocketServer* pWebSocket, websocketpp::connection_hdl hdl);</text><ellipse cx="180" cy="1048.1377" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" text-decoration="underline" textLength="449" x="189" y="1053.7437">void OnClose(server* s, WebsocketServer* pWebSocket, websocketpp::connection_hdl hdl);</text><ellipse cx="180" cy="1063.1606" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" text-decoration="underline" textLength="558" x="189" y="1068.7666">void OnMessage(server* s, WebsocketServer* pWebSocket, websocketpp::connection_hdl hdl, message_ptr msg);</text><ellipse cx="180" cy="1078.1836" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="89" x="189" y="1083.7896">void start(int port);</text><path d="M6,975.5 L6,1021.0088 A0,0 0 0 0 6,1021.0088 L134,1021.0088 A0,0 0 0 0 134,1021.0088 L134,1002.5 L168.94,998.5 L134,994.5 L134,985.5 L124,975.5 L6,975.5 A0,0 0 0 0 6,975.5 " fill="#FBFB77" filter="url(#f10k4mg3cmfcn9)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M124,975.5 L124,985.5 L134,985.5 L124,975.5 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="107" x="12" y="995.3979">WebSocket服务端</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="104" x="12" y="1013.1523">用于与教师端通信</text><!--MD5=[3682458b7332602c1d49cebe9947b2f1]
class PrivateMessageGetter--><rect codeLine="66" fill="#FEFECE" filter="url(#f10k4mg3cmfcn9)" height="138.1377" id="PrivateMessageGetter" style="stroke:#A80036;stroke-width:1.5;" width="252" x="961" y="929.5"/><ellipse cx="1022.25" cy="945.5" fill="#ADD1B2" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"/><path d="M1020.8281,950.8594 Q1018.9688,950.8594 1017.875,949.4688 Q1016.7813,948.0781 1016.7813,945.0938 Q1016.7813,942.5625 1017.9453,940.9063 Q1019.1094,939.25 1021.0938,939.25 Q1022.5625,939.25 1023.0313,939.375 Q1023.5,939.5781 1023.5,939.5781 Q1023.5,939.5781 1023.5,939.5078 Q1023.5,939.4375 1024.1094,938.5156 L1025.1563,942.1719 L1023.8281,942.5781 Q1023.3594,941.0313 1022.6953,940.3672 Q1022.0313,939.7031 1020.9688,939.7031 Q1020.5781,939.7031 1019.8125,941.2344 Q1019.0469,942.7656 1019.0469,945.0156 Q1019.0469,947.4844 1019.7109,948.875 Q1020.375,950.2656 1020.9063,950.2656 Q1021.9688,950.2656 1022.7266,949.5 Q1023.4844,948.7344 1023.8281,947.0781 L1025.1563,947.6719 Q1024.8281,949.0781 1023.9297,949.9688 Q1023.0313,950.8594 1020.8281,950.8594 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="121" x="1042.75" y="951.0576">PrivateMessageGetter</text><line style="stroke:#A80036;stroke-width:1.5;" x1="962" x2="1212" y1="961.5" y2="961.5"/><rect fill="none" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="969" y="969.5"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="65" x="981" y="978.106">long long time</text><rect fill="none" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="969" y="984.5229"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="88" x="981" y="993.1289">long long senderId</text><rect fill="none" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="969" y="999.5459"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="93" x="981" y="1008.1519">std::string rawData</text><line style="stroke:#A80036;stroke-width:1.5;" x1="962" x2="1212" y1="1014.5688" y2="1014.5688"/><ellipse cx="972" cy="1025.5688" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="226" x="981" y="1031.1748">PrivateMessageGetter(nlohmann::json decode)</text><ellipse cx="972" cy="1040.5918" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="119" x="981" y="1046.1978">std::string getRawData()</text><ellipse cx="972" cy="1055.6147" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="112" x="981" y="1061.2207">long long getSenderId()</text><path d="M788,984.5 L788,1012.2544 A0,0 0 0 0 788,1012.2544 L926,1012.2544 A0,0 0 0 0 926,1012.2544 L926,1002.5 L960.73,998.5 L926,994.5 L926,994.5 L916,984.5 L788,984.5 A0,0 0 0 0 788,984.5 " fill="#FBFB77" filter="url(#f10k4mg3cmfcn9)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M916,984.5 L916,994.5 L926,994.5 L916,984.5 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="117" x="794" y="1004.3979">接收并分析私聊消息</text><!--MD5=[f107375bbf3dfc3aaca6b08014d37283]
class PrivateMessageSender--><rect codeLine="78" fill="#FEFECE" filter="url(#f10k4mg3cmfcn9)" height="123.1147" id="PrivateMessageSender" style="stroke:#A80036;stroke-width:1.5;" width="306" x="1378" y="1323.5"/><ellipse cx="1462.75" cy="1339.5" fill="#ADD1B2" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"/><path d="M1461.3281,1344.8594 Q1459.4688,1344.8594 1458.375,1343.4688 Q1457.2813,1342.0781 1457.2813,1339.0938 Q1457.2813,1336.5625 1458.4453,1334.9063 Q1459.6094,1333.25 1461.5938,1333.25 Q1463.0625,1333.25 1463.5313,1333.375 Q1464,1333.5781 1464,1333.5781 Q1464,1333.5781 1464,1333.5078 Q1464,1333.4375 1464.6094,1332.5156 L1465.6563,1336.1719 L1464.3281,1336.5781 Q1463.8594,1335.0313 1463.1953,1334.3672 Q1462.5313,1333.7031 1461.4688,1333.7031 Q1461.0781,1333.7031 1460.3125,1335.2344 Q1459.5469,1336.7656 1459.5469,1339.0156 Q1459.5469,1341.4844 1460.2109,1342.875 Q1460.875,1344.2656 1461.4063,1344.2656 Q1462.4688,1344.2656 1463.2266,1343.5 Q1463.9844,1342.7344 1464.3281,1341.0781 L1465.6563,1341.6719 Q1465.3281,1343.0781 1464.4297,1343.9688 Q1463.5313,1344.8594 1461.3281,1344.8594 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="128" x="1483.25" y="1345.0576">PrivateMessageSender</text><line style="stroke:#A80036;stroke-width:1.5;" x1="1379" x2="1683" y1="1355.5" y2="1355.5"/><rect fill="none" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="1386" y="1363.5"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="72" x="1398" y="1372.106">std::string data</text><rect fill="none" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="1386" y="1378.5229"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="82" x="1398" y="1387.1289">long long targetId</text><line style="stroke:#A80036;stroke-width:1.5;" x1="1379" x2="1683" y1="1393.5459" y2="1393.5459"/><ellipse cx="1389" cy="1404.5459" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="280" x="1398" y="1410.1519">PrivateMessageSender(long long targetId, std::string data)</text><ellipse cx="1389" cy="1419.5688" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="155" x="1398" y="1425.1748">void setContent(std::string data)</text><ellipse cx="1389" cy="1434.5918" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="55" x="1398" y="1440.1978">void send()</text><path d="M1243.5,1371 L1243.5,1398.7544 A0,0 0 0 0 1243.5,1398.7544 L1342.5,1398.7544 A0,0 0 0 0 1342.5,1398.7544 L1342.5,1389 L1377.67,1385 L1342.5,1381 L1342.5,1381 L1332.5,1371 L1243.5,1371 A0,0 0 0 0 1243.5,1371 " fill="#FBFB77" filter="url(#f10k4mg3cmfcn9)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M1332.5,1371 L1332.5,1381 L1342.5,1381 L1332.5,1371 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="78" x="1249.5" y="1390.8979">发送私聊消息</text><!--MD5=[5497a3467eb99130277fd0d1ed8bd2ab]
class Analyst--><rect codeLine="89" fill="#FEFECE" filter="url(#f10k4mg3cmfcn9)" height="183.2065" id="Analyst" style="stroke:#A80036;stroke-width:1.5;" width="341" x="1360.5" y="907"/><ellipse cx="1507.25" cy="923" fill="#ADD1B2" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"/><path d="M1505.8281,928.3594 Q1503.9688,928.3594 1502.875,926.9688 Q1501.7813,925.5781 1501.7813,922.5938 Q1501.7813,920.0625 1502.9453,918.4063 Q1504.1094,916.75 1506.0938,916.75 Q1507.5625,916.75 1508.0313,916.875 Q1508.5,917.0781 1508.5,917.0781 Q1508.5,917.0781 1508.5,917.0078 Q1508.5,916.9375 1509.1094,916.0156 L1510.1563,919.6719 L1508.8281,920.0781 Q1508.3594,918.5313 1507.6953,917.8672 Q1507.0313,917.2031 1505.9688,917.2031 Q1505.5781,917.2031 1504.8125,918.7344 Q1504.0469,920.2656 1504.0469,922.5156 Q1504.0469,924.9844 1504.7109,926.375 Q1505.375,927.7656 1505.9063,927.7656 Q1506.9688,927.7656 1507.7266,927 Q1508.4844,926.2344 1508.8281,924.5781 L1510.1563,925.1719 Q1509.8281,926.5781 1508.9297,927.4688 Q1508.0313,928.3594 1505.8281,928.3594 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="39" x="1527.75" y="928.5576">Analyst</text><line style="stroke:#A80036;stroke-width:1.5;" x1="1361.5" x2="1700.5" y1="939" y2="939"/><ellipse cx="1371.5" cy="950" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;fill:none;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="68" x="1380.5" y="955.606">struct RegInfo</text><ellipse cx="1371.5" cy="965.0229" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;fill:none;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="65" x="1380.5" y="970.6289">struct StuInfo</text><ellipse cx="1371.5" cy="980.0459" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;fill:none;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="101" x="1380.5" y="985.6519">struct HomeworkInfo</text><line style="stroke:#A80036;stroke-width:1.5;" x1="1361.5" x2="1700.5" y1="992.0688" y2="992.0688"/><ellipse cx="1371.5" cy="1003.0688" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="240" x="1380.5" y="1008.6748">void AnaText(std::u16string data, long long qq_id)</text><ellipse cx="1371.5" cy="1018.0918" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="265" x="1380.5" y="1023.6978">void RegCommand(std::u16string data, long long qq_id)</text><ellipse cx="1371.5" cy="1033.1147" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="267" x="1380.5" y="1038.7207">void HomCommand(std::u16string data, long long qq_id)</text><ellipse cx="1371.5" cy="1048.1377" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="288" x="1380.5" y="1053.7437">void AnaFile(std::string name,std::string url, long long qq_id)</text><ellipse cx="1371.5" cy="1063.1606" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="174" x="1380.5" y="1068.7666">bool sendReview(long homeworkId)</text><ellipse cx="1371.5" cy="1078.1836" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="315" x="1380.5" y="1083.7896">void sendHomeworkNotification(long long assignmentId, int mode)</text><path d="M1736.5,984.5 L1736.5,994.5 L1701.83,998.5 L1736.5,1002.5 L1736.5,1012.2544 A0,0 0 0 0 1736.5,1012.2544 L1835.5,1012.2544 A0,0 0 0 0 1835.5,1012.2544 L1835.5,994.5 L1825.5,984.5 L1736.5,984.5 A0,0 0 0 0 1736.5,984.5 " fill="#FBFB77" filter="url(#f10k4mg3cmfcn9)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M1825.5,984.5 L1825.5,994.5 L1835.5,994.5 L1825.5,984.5 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="78" x="1742.5" y="1004.3979">消息文本分析</text><!--MD5=[63dd87716ef75a5caca5dce59428e94a]
class File--><rect codeLine="104" fill="#FEFECE" filter="url(#f10k4mg3cmfcn9)" height="348.459" id="File" style="stroke:#A80036;stroke-width:1.5;" width="339" x="624.5" y="1211"/><ellipse cx="779.75" cy="1227" fill="#ADD1B2" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"/><path d="M778.3281,1232.3594 Q776.4688,1232.3594 775.375,1230.9688 Q774.2813,1229.5781 774.2813,1226.5938 Q774.2813,1224.0625 775.4453,1222.4063 Q776.6094,1220.75 778.5938,1220.75 Q780.0625,1220.75 780.5313,1220.875 Q781,1221.0781 781,1221.0781 Q781,1221.0781 781,1221.0078 Q781,1220.9375 781.6094,1220.0156 L782.6563,1223.6719 L781.3281,1224.0781 Q780.8594,1222.5313 780.1953,1221.8672 Q779.5313,1221.2031 778.4688,1221.2031 Q778.0781,1221.2031 777.3125,1222.7344 Q776.5469,1224.2656 776.5469,1226.5156 Q776.5469,1228.9844 777.2109,1230.375 Q777.875,1231.7656 778.4063,1231.7656 Q779.4688,1231.7656 780.2266,1231 Q780.9844,1230.2344 781.3281,1228.5781 L782.6563,1229.1719 Q782.3281,1230.5781 781.4297,1231.4688 Q780.5313,1232.3594 778.3281,1232.3594 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="20" x="800.25" y="1232.5576">File</text><line style="stroke:#A80036;stroke-width:1.5;" x1="625.5" x2="962.5" y1="1243" y2="1243"/><rect fill="none" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="632.5" y="1251"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="146" x="644.5" y="1259.606">std::filesystem::path workPath</text><rect fill="none" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="632.5" y="1266.0229"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="156" x="644.5" y="1274.6289">std::filesystem::path relativePath</text><rect fill="none" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="632.5" y="1281.0459"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="139" x="644.5" y="1289.6519">std::filesystem::path infoPath</text><rect fill="none" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="632.5" y="1296.0688"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="233" x="644.5" y="1304.6748">long long classId, schoolId, homeworkId,submitId</text><rect fill="none" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="632.5" y="1311.0918"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="132" x="644.5" y="1319.6978">std::vector&lt;FileInfo&gt; fileList</text><rect fill="none" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="632.5" y="1326.1147"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="79" x="644.5" y="1334.7207">int autoIndex = 1</text><line style="stroke:#A80036;stroke-width:1.5;" x1="625.5" x2="962.5" y1="1341.1377" y2="1341.1377"/><ellipse cx="635.5" cy="1352.1377" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="307" x="644.5" y="1357.7437">File(long long classId, long long schoolId, long long homeworkId)</text><ellipse cx="635.5" cy="1367.1606" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="115" x="644.5" y="1372.7666">File(HomeworkInfo info)</text><ellipse cx="635.5" cy="1382.1836" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="177" x="644.5" y="1387.7896">std::string storeText(std::string data)</text><ellipse cx="635.5" cy="1397.2065" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="230" x="644.5" y="1402.8125">std::string delFile(std::filesystem::path fileName)</text><ellipse cx="635.5" cy="1412.2295" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="313" x="644.5" y="1417.8354">std::string downFile(std::string url, std::filesystem::path fileName)</text><ellipse cx="635.5" cy="1427.2524" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="161" x="644.5" y="1432.8584">std::string storePic(std::string url)</text><ellipse cx="635.5" cy="1442.2754" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="140" x="644.5" y="1447.8813">bool save(long long submitId)</text><ellipse cx="635.5" cy="1457.2983" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="107" x="644.5" y="1462.9043">std::string getFileList()</text><ellipse cx="635.5" cy="1472.3213" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="231" x="644.5" y="1477.9272">std::string getFile(std::filesystem::path fileName)</text><ellipse cx="635.5" cy="1487.3442" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="109" x="644.5" y="1492.9502">long long getSubmitId()</text><ellipse cx="635.5" cy="1502.3672" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="127" x="644.5" y="1507.9731">std::string getContentFile()</text><ellipse cx="635.5" cy="1517.3901" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="145" x="644.5" y="1522.9961">std::string getAttachmentFile()</text><ellipse cx="635.5" cy="1532.4131" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="57" x="644.5" y="1538.019">void delAll()</text><ellipse cx="635.5" cy="1547.436" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="301" x="644.5" y="1553.042">std::filesystem::path getFilePath(std::filesystem::path fileName)</text><path d="M998.5,1371 L998.5,1381 L963.66,1385 L998.5,1389 L998.5,1398.7544 A0,0 0 0 0 998.5,1398.7544 L1097.5,1398.7544 A0,0 0 0 0 1097.5,1398.7544 L1097.5,1381 L1087.5,1371 L998.5,1371 A0,0 0 0 0 998.5,1371 " fill="#FBFB77" filter="url(#f10k4mg3cmfcn9)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M1087.5,1371 L1087.5,1381 L1097.5,1381 L1087.5,1371 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="78" x="1004.5" y="1390.8979">本地文件管理</text><!--MD5=[cf7dacd8f7ef753f28ab609139658ae0]
class FileInfo--><rect codeLine="130" fill="#FEFECE" filter="url(#f10k4mg3cmfcn9)" height="153.1606" id="FileInfo" style="stroke:#A80036;stroke-width:1.5;" width="203" x="692.5" y="1638"/><ellipse cx="769.75" cy="1654" fill="#ADD1B2" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"/><path d="M768.3281,1659.3594 Q766.4688,1659.3594 765.375,1657.9688 Q764.2813,1656.5781 764.2813,1653.5938 Q764.2813,1651.0625 765.4453,1649.4063 Q766.6094,1647.75 768.5938,1647.75 Q770.0625,1647.75 770.5313,1647.875 Q771,1648.0781 771,1648.0781 Q771,1648.0781 771,1648.0078 Q771,1647.9375 771.6094,1647.0156 L772.6563,1650.6719 L771.3281,1651.0781 Q770.8594,1649.5313 770.1953,1648.8672 Q769.5313,1648.2031 768.4688,1648.2031 Q768.0781,1648.2031 767.3125,1649.7344 Q766.5469,1651.2656 766.5469,1653.5156 Q766.5469,1655.9844 767.2109,1657.375 Q767.875,1658.7656 768.4063,1658.7656 Q769.4688,1658.7656 770.2266,1658 Q770.9844,1657.2344 771.3281,1655.5781 L772.6563,1656.1719 Q772.3281,1657.5781 771.4297,1658.4688 Q770.5313,1659.3594 768.3281,1659.3594 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="40" x="790.25" y="1659.5576">FileInfo</text><line style="stroke:#A80036;stroke-width:1.5;" x1="693.5" x2="894.5" y1="1670" y2="1670"/><rect fill="none" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="700.5" y="1678"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="135" x="712.5" y="1686.606">std::filesystem::path filePath</text><rect fill="none" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="700.5" y="1693.0229"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="141" x="712.5" y="1701.6289">std::filesystem::path fileName</text><rect fill="none" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="700.5" y="1708.0459"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="111" x="712.5" y="1716.6519">FileFormats fileFormats</text><line style="stroke:#A80036;stroke-width:1.5;" x1="693.5" x2="894.5" y1="1723.0688" y2="1723.0688"/><ellipse cx="703.5" cy="1734.0688" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="177" x="712.5" y="1739.6748">FileInfo(std::filesystem::path filePath)</text><ellipse cx="703.5" cy="1749.0918" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="160" x="712.5" y="1754.6978">std::filesystem::path getFilePath()</text><ellipse cx="703.5" cy="1764.1147" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="166" x="712.5" y="1769.7207">std::filesystem::path getFileName()</text><ellipse cx="703.5" cy="1779.1377" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="136" x="712.5" y="1784.7437">FileFormats getFileFormats()</text><path d="M930.5,1700.5 L930.5,1710.5 L895.71,1714.5 L930.5,1718.5 L930.5,1728.2544 A0,0 0 0 0 930.5,1728.2544 L1003.5,1728.2544 A0,0 0 0 0 1003.5,1728.2544 L1003.5,1710.5 L993.5,1700.5 L930.5,1700.5 A0,0 0 0 0 930.5,1700.5 " fill="#FBFB77" filter="url(#f10k4mg3cmfcn9)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M993.5,1700.5 L993.5,1710.5 L1003.5,1710.5 L993.5,1700.5 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="52" x="936.5" y="1720.3979">文件信息</text><!--MD5=[b2c30c259724686b2a9ed2a2380988d5]
link WebsocketClient to QQMessage--><path codeLine="143" d="M1156,386.2 C1156,425.49 1156,465.84 1156,501.72 " fill="none" id="WebsocketClient-to-QQMessage" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="1156,506.98,1160,497.98,1156,501.98,1152,497.98,1156,506.98" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="65" x="1180" y="431.8979">接收到消息</text><path d="M1161,440.7544 L1161,467.7544 L1260,467.7544 L1260,450.7544 L1250,440.7544 L1161,440.7544 " fill="#FBFB77" filter="url(#f10k4mg3cmfcn9)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M1250,440.7544 L1250,450.7544 L1260,450.7544 L1250,440.7544 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="78" x="1167" y="460.6523">执行回调函数</text><!--MD5=[46e79f4682813b6dffb9507143b2660c]
link QQMessage to PrivateMessageGetter--><path codeLine="145" d="M1135.2,735.17 C1123.94,796.47 1110.35,870.42 1100.48,924.17 " fill="none" id="QQMessage-to-PrivateMessageGetter" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="1099.53,929.3,1105.0817,921.165,1100.4282,924.3813,1097.2118,919.7279,1099.53,929.3" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="65" x="1166" y="797.3979">接收到消息</text><path d="M1135,806.2544 L1135,851.2544 L1258,851.2544 L1258,816.2544 L1248,806.2544 L1135,806.2544 " fill="#FBFB77" filter="url(#f10k4mg3cmfcn9)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M1248,806.2544 L1248,816.2544 L1258,816.2544 L1248,806.2544 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="102" x="1141" y="826.1523">传送原始json数据</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="52" x="1141" y="843.9067">解析数据</text><!--MD5=[11dfb13d721171dcccad8a2176488b41]
link QQMessage to Analyst--><path codeLine="148" d="M1269.02,735.17 C1322.62,788.84 1385.91,852.22 1436.86,903.23 " fill="none" id="QQMessage-to-Analyst" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="1440.51,906.89,1436.993,897.6905,1436.9816,903.3473,1431.3248,903.3359,1440.51,906.89" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="52" x="1410" y="827.3979">开始分析</text><!--MD5=[70e541c2e24cb9e9eb853f565ed84834]
link PrivateMessageGetter to Analyst--><path codeLine="149" d="M1213.04,998.5 C1257.2,998.5 1307.63,998.5 1355.11,998.5 " fill="none" id="PrivateMessageGetter-to-Analyst" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="1360.29,998.5,1351.29,994.5,1355.29,998.5,1351.29,1002.5,1360.29,998.5" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="65" x="1254.25" y="950.3979">接收到消息</text><path d="M1235.25,959.2544 L1235.25,986.2544 L1334.25,986.2544 L1334.25,969.2544 L1324.25,959.2544 L1235.25,959.2544 " fill="#FBFB77" filter="url(#f10k4mg3cmfcn9)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M1324.25,959.2544 L1324.25,969.2544 L1334.25,969.2544 L1324.25,959.2544 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="78" x="1241.25" y="979.1523">传输文本内容</text><!--MD5=[3891102abea0227857221f481a310f67]
link Analyst to PrivateMessageSender--><path codeLine="152" d="M1531,1090.13 C1531,1160.1 1531,1255.27 1531,1318.11 " fill="none" id="Analyst-to-PrivateMessageSender" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="1531,1323.33,1535,1314.33,1531,1318.33,1527,1314.33,1531,1323.33" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="52" x="1591" y="1135.8979">分析完成</text><path d="M1536,1144.7544 L1536,1171.7544 L1694,1171.7544 L1694,1154.7544 L1684,1144.7544 L1536,1144.7544 " fill="#FBFB77" filter="url(#f10k4mg3cmfcn9)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M1684,1144.7544 L1684,1154.7544 L1694,1154.7544 L1684,1144.7544 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="137" x="1542" y="1164.6523">向相应QQ发送返回结果</text><!--MD5=[bcaadcfae54571f0e15ca8d725ba7149]
link Analyst to File--><path codeLine="155" d="M1360.23,1046.68 C1247.5,1082.17 1099.33,1137.34 981,1211 C976.64,1213.72 972.28,1216.54 967.95,1219.47 " fill="none" id="Analyst-to-File" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="963.62,1222.42,973.3096,1220.6559,967.7514,1219.6038,968.8036,1214.0456,963.62,1222.42" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="104" x="1223" y="1135.8979">保存提交作业内容</text><path d="M1159,1144.7544 L1159,1171.7544 L1387,1171.7544 L1387,1154.7544 L1377,1144.7544 L1159,1144.7544 " fill="#FBFB77" filter="url(#f10k4mg3cmfcn9)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M1377,1144.7544 L1377,1154.7544 L1387,1154.7544 L1377,1144.7544 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="207" x="1165" y="1164.6523">服务端存储文本 图片 代码 其他附件</text><!--MD5=[ea78d0d1c9ee5ea8d70c9884bccc9b22]
link File to FileInfo--><path codeLine="158" d="M794,1564.51 C794,1588.43 794,1611.93 794,1632.94 " fill="none" id="File-FileInfo" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="794,1637.94,798,1628.94,794,1632.94,790,1628.94,794,1637.94" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="794,1559.34,790,1568.34,794,1564.34,798,1568.34,794,1559.34" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="78" x="795" y="1604.8979">查询文件信息</text><!--MD5=[81ffde03964e694cc6aaa943c5a0a0dc]
link WebsocketServer to File--><path codeLine="160" d="M542.82,1093.98 C572.37,1128.1 606.77,1167.82 640.46,1206.72 " fill="none" id="WebsocketServer-File" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="644.14,1210.97,641.2643,1201.5503,640.8637,1207.193,635.2211,1206.7924,644.14,1210.97" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="539.49,1090.13,542.3657,1099.5497,542.7663,1093.907,548.4089,1094.3076,539.49,1090.13" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="78" x="668" y="1135.8979">传输文件内容</text><path d="M623,1144.7544 L623,1171.7544 L787,1171.7544 L787,1154.7544 L777,1144.7544 L623,1144.7544 " fill="#FBFB77" filter="url(#f10k4mg3cmfcn9)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M777,1144.7544 L777,1154.7544 L787,1154.7544 L777,1144.7544 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="143" x="629" y="1164.6523">教师端发出下载文件请求</text><!--MD5=[4679c29e0fdb6b9a90203971d36136f1]
link DataManager to Analyst--><path codeLine="163" d="M1531,650.52 C1531,703.26 1531,818.21 1531,901.38 " fill="none" id="DataManager-Analyst" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="1531,906.81,1535,897.81,1531,901.81,1527,897.81,1531,906.81" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="1531,645.21,1527,654.21,1531,650.21,1535,654.21,1531,645.21" style="stroke:#A80036;stroke-width:1.0;"/><path d="M1536,770 L1536,868 L1687,868 L1687,780 L1677,770 L1536,770 " fill="#FBFB77" filter="url(#f10k4mg3cmfcn9)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M1677,770 L1677,780 L1687,780 L1677,770 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="117" x="1542" y="789.8979">查询并返回相关数据</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="130" x="1542" y="807.6523">注册信息，班级，作业</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="0" x="1546" y="825.4067"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="52" x="1542" y="843.1611">提交作业</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="65" x="1542" y="860.9155">更新数据库</text><!--MD5=[63440ff5ab38e8b6f10feac6c5ba693d]
@startuml
package DataManager
{
    class DataManager
    note left: 数据库操作
}

class QQMessage
{
    + {static} void _InitClient(std::string url = "127.0.0.1:6700")
	+ {static} void _InitServer(int port)
	+ {static} void _Stop()
    + {static} void readMessage(const std::string& message)
	+ std::string connectUrl
	+ std::map<long long, PeerStatus> status
	+ std::map<long long, RegInfo> regStatus
	+ std::map<long long, StuInfo> getStuInfo
	+ std::map<long long, HomeworkInfo> getHomeworkInfo
	+ std::map<long long, long long>getSubmitId
	+ WebsocketClient wsClient
	+ WebsocketServer wsServer
}
note left: 初始化调度其他类\n启动WebSocket服务端和客户端

class WebsocketClient
{
    - connection_metadata::ptr m_ConnectionMetadataPtr
	- client m_WebsocketClient
	- websocketpp::lib::shared_ptr<websocketpp::lib::thread> m_Thread;
	- std::string lastURL
	{method}- OnOpenFunc m_OnOpenFunc
	{method}- OnFailFunc m_OnFailFunc
	{method}- OnCloseFunc m_OnCloseFunc
	{method}- OnMessageFunc m_MessageFunc
    + WebsocketClient()
	+ {abstract} ~WebsocketClient()
	+ bool Connect(std::string const& url)
	+ bool Close(std::string reason = "")
	+ bool Send(std::string message)
	+ connection_metadata::ptr GetConnectionMetadataPtr()
	+ void OnOpen(client* c, websocketpp::connection_hdl hdl)
	+ void OnFail(client* c, websocketpp::connection_hdl hdl)
	+ void OnClose(client* c, websocketpp::connection_hdl hdl)
	+ void OnMessage(websocketpp::connection_hdl, client::message_ptr msg)
	+ void SetOnOpenFunc(OnOpenFunc func)
	+ void SetOnFailFunc(OnFailFunc func)
	+ void SetOnCloseFunc(OnCloseFunc func)
	+ void SetMessageFunc(OnMessageFunc func)
}
note left: WebSocket服务端\n用于接收go-cqhttp发送的消息

class WebsocketServer
{
    + WebsocketServer();
    + ~WebsocketServer();
    + {static} void OnOpen(server* s, WebsocketServer* pWebSocket, websocketpp::connection_hdl hdl);
    + {static} void OnClose(server* s, WebsocketServer* pWebSocket, websocketpp::connection_hdl hdl);
    + {static} void OnMessage(server* s, WebsocketServer* pWebSocket, websocketpp::connection_hdl hdl, message_ptr msg);
    + void start(int port);

    - server echo_server;
    - con_list m_connection_list;
    - websocketpp::lib::shared_ptr<websocketpp::lib::thread> m_thread;
}
note left: WebSocket服务端\n用于与教师端通信

class PrivateMessageGetter
{
    - long long time
    - long long senderId
    - std::string rawData

    + PrivateMessageGetter(nlohmann::json decode)
    + std::string getRawData()
    + long long getSenderId()
}
note left: 接收并分析私聊消息

class PrivateMessageSender
{
	- std::string data
	- long long targetId

	+ PrivateMessageSender(long long targetId, std::string data)
	+ void setContent(std::string data)
	+ void send()
}
note left: 发送私聊消息

class Analyst
{
    + struct RegInfo
    + struct StuInfo
    + struct HomeworkInfo

    + void AnaText(std::u16string data, long long qq_id)
    + void RegCommand(std::u16string data, long long qq_id)
    + void HomCommand(std::u16string data, long long qq_id)
    + void AnaFile(std::string name,std::string url, long long qq_id)
    + bool sendReview(long homeworkId)
    + void sendHomeworkNotification(long long assignmentId, int mode)
}
note right: 消息文本分析

class File
{
	- std::filesystem::path workPath
	- std::filesystem::path relativePath
	- std::filesystem::path infoPath
	- long long classId, schoolId, homeworkId,submitId
	- std::vector<FileInfo> fileList
	- int autoIndex = 1

	+ File(long long classId, long long schoolId, long long homeworkId)
	+ File(HomeworkInfo info)
	+ std::string storeText(std::string data)
	+ std::string delFile(std::filesystem::path fileName)
	+ std::string downFile(std::string url, std::filesystem::path fileName)
	+ std::string storePic(std::string url)
	+ bool save(long long submitId)
	+ std::string getFileList()
	+ std::string getFile(std::filesystem::path fileName)
	+ long long getSubmitId()
	+ std::string getContentFile()
	+ std::string getAttachmentFile()
	+ void delAll()
	+ std::filesystem::path getFilePath(std::filesystem::path fileName)
}
note right: 本地文件管理

class FileInfo
{
	- std::filesystem::path filePath
	- std::filesystem::path fileName
	- FileFormats fileFormats

	+ FileInfo(std::filesystem::path filePath)
	+ std::filesystem::path getFilePath()
	+ std::filesystem::path getFileName()
	+ FileFormats getFileFormats()
}
note right: 文件信息

WebsocketClient - -> QQMessage: 接收到消息
note on link : 执行回调函数
QQMessage - -> PrivateMessageGetter: 接收到消息
note on link : 传送原始json数据\n解析数据

QQMessage - -> Analyst : 开始分析
PrivateMessageGetter -> Analyst: 接收到消息
note on link : 传输文本内容

Analyst - -> PrivateMessageSender : 分析完成
note on link : 向相应QQ发送返回结果

Analyst - -> File : 保存提交作业内容
note on link : 服务端存储文本 图片 代码 其他附件

File <- -> FileInfo : 查询文件信息

WebsocketServer <- -> File: 传输文件内容
note on link : 教师端发出下载文件请求

DataManager <- -> Analyst
note on link : 查询并返回相关数据\n注册信息，班级，作业\n\n提交作业\n更新数据库
@enduml

PlantUML version 1.2021.7(Sun May 23 20:40:07 CST 2021)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Default Encoding: GBK
Language: zh
Country: CN
--></g></svg>